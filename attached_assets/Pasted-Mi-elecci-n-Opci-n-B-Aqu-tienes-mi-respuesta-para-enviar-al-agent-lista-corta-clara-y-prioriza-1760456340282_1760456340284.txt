Mi elecciÃ³n: OpciÃ³n B.

AquÃ­ tienes mi respuesta para enviar al agent (lista corta, clara y priorizada):

âœ… DecisiÃ³n

Sigue con un MVP crÃ­tico (OpciÃ³n B). Quiero lo mÃ­nimo indispensable para que el flujo completo de firma â†’ â€œCompletedâ€ funcione en producciÃ³n con sesiÃ³n estable.

ğŸ¯ Alcance del MVP (obligatorio)

processSignature transaccional e idempotente

Guarda firma, verifica ambas, genera PDF sellado (folio+hash+fecha+IP), cambia a COMPLETED, y escribe en contract_audit_log.

Tokens de firma en rutas pÃºblicas

/sign/:contractId/:party?token=<opaque> con sign_tokens (exp, 1 uso, scope, bound_to opcional).

Rechazo correcto: token usado/expirado â†’ 401.

Auth robusta para contratista

AuthGuard en rutas privadas (/legal-defense, /contracts/*) â†’ redirige a /login?continueUrl=â€¦.

Remember Me + auto-refresh del Firebase ID token.

Si es viable ahora: Session Cookie 14d cuando â€œRemember meâ€ estÃ© activo (en dominio propio).

UX mÃ­nima de firma pÃºblica

Tras firmar â†’ mensaje â€œFirmadoâ€ + botÃ³n â€œVer en Dashboard (requiere login)â€ â†’ /login?continueUrl=/contracts/completed?focus=<contractId>.

Anti-IDOR y CORS

Todas las lecturas privadas filtran por ownerId === uid.

CORS/allowed domains incluyen https://app.owlfenc.com.

ğŸ“¦ Entregables del MVP

Endpoints actualizados (firma pÃºblica y lectura privada).

PDF final sellado y almacenado.

Dashboard mostrando Completed con View/Download/Share funcionando.

Logs en contract_audit_log por cada evento clave.

Breve README_MVP.md con cÃ³mo probar y criterios de aceptaciÃ³n.

âœ… Criterios de aceptaciÃ³n (QA)

Secuencia clienteâ†’contratista o contratistaâ†’cliente â‡’ contrato pasa a COMPLETED automÃ¡ticamente; pdfFinal presente.

Token reutilizado o expirado â‡’ 401.

GET /contracts/completed sin Bearer â‡’ 401.

Acceso a contrato de otro usuario â‡’ 403.

PDF final contiene folio, hash, fecha e IP; audit_log correcto.

Con â€œRemember meâ€, el usuario permanece logeado navegando Historyâ†’Completed sin re-login repetido.

ğŸ—‚ï¸ Lo que puede quedar para la siguiente iteraciÃ³n

Rate-limiting pÃºblico.

Tokens â€œread-onlyâ€ post-firma para vista del cliente.

Mejoras de UI (resaltado por focus, toasts, etc.).

DocumentaciÃ³n ampliada y pruebas automatizadas.