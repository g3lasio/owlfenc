<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Estimate</title>
  <style>
    @page { margin: 2in; size: letter; }
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background-color: #fff; color: #333;
      max-width: 100%; overflow-wrap: break-word;
    }
    .estimate-container {
      position: relative; max-width: 100%; margin: 0 auto;
      background: #fff; padding: 20px; box-sizing: border-box;
    }
    .watermark {
      position: absolute; top:50%; left:50%; width:400px; height:400px;
      background: url('https://i.postimg.cc/G3ZFZTjy/logo-mervin.png') no-repeat center center;
      background-size: contain; opacity: 0.05;
      transform: translate(-50%, -50%);
      pointer-events: none; z-index: 0;
    }
    @import url('https://fonts.googleapis.com/css2?family=Quantico&display=swap');
    .header {
      display: flex; justify-content: space-between; align-items: flex-start;
      border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 20px;
      position: relative; z-index:1;
    }
    .company-details { flex:1; text-align:left; line-height:1.4; }
    .company-details .name { font-weight:bold; }
    .company-details strong { font-weight:bold; }
    .company-logo { flex:1; text-align:center; }
    .company-logo img {
      max-height:60px; max-width:100%; border:2px solid rgba(0,0,0,0.1);
      padding:4px; box-sizing:border-box;
    }
    .estimate-info { flex:1; text-align:right; line-height:1.4; }
    .section { margin-bottom:20px; position:relative; z-index:1; }
    .section h2 {
      font-size:1.2em; margin-bottom:10px;
      border-bottom:1px solid #eee; padding-bottom:5px;
      color:#333; font-weight:bold;
    }
    .client-info { text-align:right; }
    .client-info pre {
      margin:0; font-family:inherit; line-height:1.5; color:#333;
    }
    .project-details { text-align:center; }
    .project-details pre {
      white-space:pre-wrap; word-wrap:break-word; max-width:100%;
      overflow:hidden; font-family:inherit; line-height:1.4;
      display:inline-block; text-align:left;
    }
    .items table {
      width:100%; table-layout:fixed; border-collapse:collapse; margin-bottom:20px;
    }
    .items th, .items td {
      border:2px solid #bbb; padding:8px; text-align:center; color:#333;
    }
    .items thead th {
      background-color:#00FFB8; color:#000; font-weight:bold;
    }
    .items th:nth-child(1), .items td:nth-child(1) { width:20%; }
    .items th:nth-child(2), .items td:nth-child(2) { width:35%; }
    .items th:nth-child(3), .items td:nth-child(3) { width:15%; }
    .items th:nth-child(4), .items td:nth-child(4) { width:15%; }
    .items th:nth-child(5), .items td:nth-child(5) { width:15%; }
    .summary { text-align:right; margin-top:10px; }
    .summary p { margin:4px 0; }
    .summary p strong { font-weight:bold; }
    .thank-you {
      position:relative; padding:20px; margin:20px auto;
      max-width:600px; background-color:#111; color:#0ff;
      font-family:'Quantico',sans-serif; font-style:italic;
      border-radius:8px; border:4px solid rgba(0,255,255,0.5);
      text-align:center; box-shadow:0 0 15px rgba(0,255,255,0.6);
      z-index:1;
    }
    .thank-you:before, .thank-you:after {
      content:''; position:absolute; width:24px; height:24px;
      border:4px solid #0ff; box-sizing:border-box; z-index:1;
    }
    .thank-you:before { top:0; left:0; border-right:none; border-bottom:none; animation:scan 3s infinite; }
    .thank-you:after { bottom:0; right:0; border-left:none; border-top:none; animation:scan 3s infinite; }
    @keyframes scan {0%{opacity:0.2}50%{opacity:1}100%{opacity:0.2}}
    .footer { text-align:center; margin:20px 0; font-size:0.9em; color:#666; position:relative; z-index:1; }
    .footer:before {
      content:''; display:block; width:100%; height:4px;
      background:linear-gradient(90deg,transparent,#0ff,transparent);
      margin-bottom:8px; position:relative; z-index:1;
    }
    a { color:#007BFF; text-decoration:none; }
  </style>
</head>
<body>
  <div class="estimate-container">
    <div class="watermark"></div>
    <div class="header">
      <div class="company-details">
        <div class="name">{{company.name}}</div>
        <strong>Address:</strong> {{company.address}}<br>
        <strong>Phone:</strong> {{company.phone}}<br>
        <strong>Email:</strong> <a href="mailto:{{company.email}}">{{company.email}}</a><br>
        <strong>Website:</strong> <a href="{{company.website}}">{{company.website}}</a>
      </div>
      <div class="company-logo">
        <img src="{{company.logo}}" alt="Company Logo">
      </div>
      <div class="estimate-info">
        <strong>ESTIMATE</strong><br>
        Estimate #: {{estimate.number}}<br>
        Estimate Date: {{estimate.date}}<br>
        Valid Until: {{estimate.valid_until}}
      </div>
    </div>
    <div class="section client-info">
      <h2>Client Information</h2>
      <pre>{{client.name}}
<strong>Client Phone:</strong> {{client.phone}}
<strong>Client Email:</strong> {{client.email}}
<strong>Client Address:</strong> {{client.address}}</pre>
    </div>
    <div class="section project-details">
      <h2>Project Details</h2>
      {{#if estimate.project_description}}
        <pre>{{estimate.project_description}}</pre>
      {{else}}
        <p style="font-style:italic;color:#666;">Descripci√≥n del proyecto no disponible</p>
      {{/if}}
    </div>
    <div class="section items">
      <h2>Items</h2>
      <table class="items">
        <thead>
          <tr>
            <th>Item</th>
            <th>Description</th>
            <th>Qty</th>
            <th>Unit Price</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
          {{#each estimate.items}}
            <tr>
              <td>{{code}}</td>
              <td>{{description}}</td>
              <td>{{qty}}</td>
              <td>{{unit_price}}</td>
              <td>{{total}}</td>
            </tr>
          {{else}}
            <tr>
              <td colspan="5" style="text-align:center;font-style:italic;color:#666;">No hay items disponibles</td>
            </tr>
          {{/each}}
        </tbody>
      </table>
      <div class="summary">
        <p>Subtotal: {{estimate.subtotal}}</p>
        <p>Discounts: {{estimate.discounts}}</p>
        <p>Tax ({{estimate.tax_rate}}%): {{estimate.tax_amount}}</p>
        <p><strong>Total Estimate: {{estimate.total}}</strong></p>
      </div>
    </div>
    <div class="thank-you">Thank you for your trust in our services. We are committed to delivering excellence and look forward to partnering on future projects.</div>
    <div class="section notes center">
      <h2>Notes & Terms</h2>
      <ul>
        <li>This estimate is valid for 30 days from the issue date. Prices may change after this period due to fluctuations in materials, labor, or market conditions.</li>
        <li>Project execution, specific terms, and additional conditions will be detailed in the formal contract to be signed by both parties.</li>
        <li>For questions, please contact us directly.</li>
      </ul>
    </div>
    <div class="footer"><div class="footer-line"></div><div>Powered by Mervin AI</div></div>
  </div>
</body>
</html>
